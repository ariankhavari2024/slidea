<!DOCTYPE html>
<html data-wf-page="67f1d16c9fcb04b14e607539" data-wf-site="67f1d16c9fcb04b14e6074f2"> {# Example page ID, adjust if needed #}
<head>
  <meta charset="utf-8">
  <title>Dashboard - SlideaAI</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="Webflow" name="generator">

  {# *** Add CSRF Token Meta Tag *** #}
  <meta name="csrf-token" content="{{ csrf_token() }}">

  {# *** Link CSS using url_for *** #}
  <link href="{{ url_for('static', filename='css/normalize.css') }}" rel="stylesheet" type="text/css">
  <link href="{{ url_for('static', filename='css/webflow.css') }}" rel="stylesheet" type="text/css">
  <link href="{{ url_for('static', filename='css/slidea-ai-ui.webflow.css') }}" rel="stylesheet" type="text/css">
  {# Include Bootstrap CSS if using its alert dismissal JS #}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">


  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Be Vietnam Pro:regular,500,600"]  }});</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>

  {# *** Update Favicon paths using url_for *** #}
  <link href="{{ url_for('static', filename='images/custom_favicon.png') }}" rel="shortcut icon" type="image/x-icon">
  <link href="{{ url_for('static', filename='images/custom_favicon.png') }}" rel="apple-touch-icon">

  {# *** CSS for Dashboard Page ONLY (Including NEW Button Styles) *** #}
  <style>
    :root {
        /* Dashboard Specific Theme Colors */
        --theme-bg: #090911; /* Match index/features */
        --theme-card-bg: rgba(26, 28, 46, 0.8);
        --theme-card-border: rgba(138, 84, 255, 0.2);
        --theme-card-hover-bg: rgba(36, 38, 66, 0.9);
        --theme-text-primary: #FFFFFF;
        --theme-text-secondary: #A0A3BD;
        --theme-heading-gradient: linear-gradient(180deg, #FFFFFF, #E0E7FF);
        /* Updated Button Gradients & Glow */
        --theme-button-gradient: linear-gradient(90deg, #8B5CF6, #EC4899); /* Vibrant Purple to Pink */
        --theme-button-hover-gradient: linear-gradient(90deg, #A78BFA, #F472B6); /* Lighter on hover */
        --theme-button-glow: 0 0 15px rgba(236, 72, 153, 0.5), 0 0 8px rgba(139, 92, 246, 0.4); /* Pink/Purple Glow */
        --theme-button-hover-glow: 0 0 25px rgba(236, 72, 153, 0.7), 0 0 12px rgba(139, 92, 246, 0.6); /* Stronger Glow on hover */
        /* --- End Button Styles --- */
        --theme-button-action: #5865F2;
        --theme-button-action-hover: #4752C4;
        --theme-button-delete: #ED4245;
        --theme-button-delete-hover: #C63537;
        --theme-button-cancel: #FAA61A;
        --theme-button-cancel-hover: #D48D0A;
        --theme-link: #A0A3BD;
        --theme-link-hover: #FFFFFF;
        --status-pending-bg: #5865F2;
        --status-failed-bg: #ED4245;
        --status-complete-bg: #3BA55D;
        --credit-color: #facc15;
        --credit-glow-color: rgba(250, 204, 21, 0.5);
        --border-radius-base: 0.75rem;
        --border-radius-small: 0.375rem;
    }
    body {
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
        background-color: var(--theme-bg); /* Use the theme background */
        color: var(--theme-text-secondary);
        font-family: "Be Vietnam Pro", sans-serif;
    }
    body.loaded { opacity: 1; }

    /* Credit Display Style (Keep if not global) */
    .nav-credits {
        color: var(--credit-color) !important;
        margin-left: 0.5rem;
        margin-right: 0.5rem;
        font-size: 0.8em; /* Default size, overridden on mobile */
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        padding: 0.3rem 0.6rem; /* Default padding */
        line-height: 1;
        text-shadow: 0 0 8px var(--credit-glow-color);
        white-space: nowrap;
    }
    .nav-credits svg {
        width: 0.9em; height: 0.9em;
        margin-right: 0.3em;
        fill: currentColor;
        vertical-align: -0.1em;
        filter: drop-shadow(0 0 3px var(--credit-glow-color));
    }

    /* --- Dashboard Layout & Header --- */
    .dashboard-section { padding-top: 3rem; padding-bottom: 5rem; flex-grow: 1; }
    .dashboard-header { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1); gap: 1rem; }
    .dashboard-header h1 { font-size: 2.5rem; line-height: 1.2; font-weight: 600; margin: 0; background: var(--theme-heading-gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }

    /* --- NEW: Glowy Button Style --- */
    .btn-create-glowy {
        background: var(--theme-button-gradient);
        color: white !important;
        padding: 0.8rem 1.5rem; /* Slightly larger padding */
        border-radius: var(--border-radius-small);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center; /* Center content */
        font-weight: 500;
        border: none;
        transition: all 0.3s ease; /* Smooth transition for hover */
        box-shadow: var(--theme-button-glow); /* Apply initial glow */
        font-size: 0.95rem; /* Slightly larger font */
        position: relative; /* Needed for potential pseudo-elements */
        overflow: hidden; /* Clip potential effects */
    }
    .btn-create-glowy:hover {
        background: var(--theme-button-hover-gradient);
        transform: translateY(-2px) scale(1.02); /* Lift and slightly enlarge */
        box-shadow: var(--theme-button-hover-glow); /* Enhance glow on hover */
    }
    .btn-create-glowy svg {
        margin-right: 0.6em; /* Increase space */
        width: 1.1em; /* Slightly larger icon */
        height: 1.1em;
        filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3)); /* Subtle icon shadow */
    }
    /* --- END NEW --- */

    .dashboard-welcome { color: var(--theme-text-secondary); margin-bottom: 2.5rem; font-size: 1.1rem; }

    /* --- Presentation Card Styling --- */
    .presentation-card-wf { background-color: var(--theme-card-bg); border: 1px solid var(--theme-card-border); border-radius: var(--border-radius-base); margin-bottom: 1.5rem; padding: 1.5rem 2rem; display: flex; align-items: center; transition: all 0.2s ease-in-out; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15); opacity: 0; }
    .presentation-card-wf:hover { background-color: var(--theme-card-hover-bg); transform: translateY(-4px); box-shadow: 0 8px 25px rgba(138, 84, 255, 0.15); }
    .thumbnail-container-wf { flex-shrink: 0; width: 144px; height: 81px; background-color: #2a2f45; border-radius: 0.5rem; margin-right: 1.5rem; overflow: hidden; display: flex; align-items: center; justify-content: center; border: 1px solid rgba(255, 255, 255, 0.08); }
    .thumbnail-container-wf img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .thumbnail-container-wf span { color: var(--theme-text-secondary); font-size: 0.75rem; text-align: center; padding: 0 0.5rem; }
    .presentation-content-wf { flex-grow: 1; min-width: 0; }
    .presentation-title-wf { font-size: 1.15rem; font-weight: 600; margin-bottom: 0.3rem; color: var(--theme-text-primary) !important; background: none; -webkit-background-clip: unset; background-clip: unset; -webkit-text-fill-color: unset; }
    .presentation-meta-wf { font-size: 0.8rem; color: var(--theme-text-secondary); margin-bottom: 0.6rem; }
    .status-badge-wf { display: inline-flex; align-items: center; font-size: 0.7rem; padding: 0.3em 0.7em; border-radius: 99px; font-weight: 500; color: #fff; text-transform: uppercase; letter-spacing: 0.05em; min-width: 100px; justify-content: center; }
    .status-badge-wf svg, .status-badge-wf .spinner-border-sm { width: 0.9em; height: 0.9em; margin-right: 0.4em; vertical-align: -0.1em; }
    .status-badge-wf .spinner-border-sm { margin-right: 0; }
    .status-badge-wf.bg-pending { background-color: var(--status-pending-bg); }
    .status-badge-wf.bg-failed { background-color: var(--status-failed-bg); }
    .status-badge-wf.bg-complete { background-color: var(--status-complete-bg); }

    /* Action Buttons Styling */
    .presentation-actions-wf { flex-shrink: 0; margin-left: 1.5rem; display: flex; align-items: center; gap: 0.75rem; }
    .presentation-actions-wf form { margin-bottom: 0; display: inline-block; }
    .btn-action { display: inline-flex; align-items: center; justify-content: center; padding: 0.5rem 1rem; font-size: 0.875rem; font-weight: 500; border-radius: var(--border-radius-small); text-decoration: none; border: none; transition: all 0.2s ease; cursor: pointer; }
    .btn-action svg { width: 1rem; height: 1rem; margin-right: 0.4rem; }
    .btn-action-edit { background-color: var(--theme-button-action); color: white !important; }
    .btn-action-edit:hover { background-color: var(--theme-button-action-hover); }
    .btn-action-link { background-color: transparent; color: var(--theme-link); padding: 0.5rem 0.5rem; font-size: 0.8rem; font-weight: 400; }
    .btn-action-link svg { margin-right: 0.25rem; width: 0.9rem; height: 0.9rem; }
    .btn-action-link:hover { color: var(--theme-link-hover); background-color: rgba(255, 255, 255, 0.05); }
    .btn-action-link.delete { color: var(--theme-button-delete); }
    .btn-action-link.delete:hover { color: #ff7f7f; background-color: rgba(237, 66, 69, 0.1); }
    .btn-action-link.cancel { color: var(--theme-button-cancel); }
    .btn-action-link.cancel:hover { color: #fcd34d; background-color: rgba(250, 166, 26, 0.1); }
    .presentation-actions-wf a.disabled, .presentation-actions-wf button:disabled { opacity: 0.4; pointer-events: none; }

    /* Keyframes for Staggered Animation */
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

    /* Responsive adjustments */
    @media (max-width: 991px) {
        /* --- Mobile Navbar Fixes --- */
        .nav-button-wrapper.hide-desktop { display: flex !important; flex-direction: row !important; align-items: center !important; gap: 0.5rem !important; width: 100%; padding-top: 1rem; border-top: 1px solid rgba(255, 255, 255, 0.1); margin-top: 1rem; margin-bottom: 0; justify-content: center; }
        .nav-button-wrapper.hide-desktop .button-stroke { padding: 0.5rem 0.75rem !important; font-size: 0.8rem !important; flex-grow: 1; text-align: center; margin-left: 0 !important; }
         .nav-button-wrapper.hide-desktop .button-stroke .button { padding: 0 !important; }
        .nav-button-wrapper.hide-desktop .nav-credits { font-size: 0.7em !important; padding: 0.2rem 0.4rem !important; margin: 0 !important; order: -1; }
        /* --- End Mobile Navbar Fixes --- */

        .presentation-card-wf { align-items: flex-start; }
        .presentation-actions-wf { flex-direction: column; align-items: flex-end; margin-left: 1rem; gap: 0.5rem;}
    }
    @media (max-width: 767px) {
        .dashboard-header h1 { font-size: 2rem; line-height: 2.5rem; }
        .btn-create-glowy { padding: 0.7rem 1.2rem; font-size: 0.9rem; } /* Adjust padding for mobile */
        .presentation-card-wf { flex-direction: column; align-items: stretch; padding: 1rem; }
        .thumbnail-container-wf { width: 100%; height: auto; aspect-ratio: 16 / 9; max-height: 150px; margin-right: 0; margin-bottom: 1rem; }
        .presentation-actions-wf { flex-direction: row; align-items: center; justify-content: flex-start; margin-left: 0; margin-top: 1rem; flex-wrap: wrap; gap: 0.5rem;}
        .presentation-actions-wf .btn-action, .presentation-actions-wf .btn-action-link { min-width: auto; }
    }

    /* Flash message styling (Bootstrap compatible) */
    .alert { padding: 0.75rem 1.25rem; margin-bottom: 1rem; border: 1px solid transparent; border-radius: .375rem; width: 100%; box-sizing: border-box; font-size: 0.9rem; display: flex; justify-content: space-between; align-items: center; position: relative; z-index: 10; }
    .alert-danger { color: #842029 !important; background-color: #f8d7da !important; border-color: #f5c2c7 !important; }
    .alert-success { color: #0f5132 !important; background-color: #d1e7dd !important; border-color: #badbcc !important; }
    .alert-warning { color: #664d03 !important; background-color: #fff3cd !important; border-color: #ffecb5 !important; }
    .alert-info { color: #055160 !important; background-color: #cff4fc !important; border-color: #b6effb !important; }
    .alert .btn-close { padding: 0.5rem 0.75rem; background: transparent; border: 0; opacity: 0.7; filter: invert(1) grayscale(100%) brightness(200%); }

  </style>

</head>
<body class="body-fade-in loaded">
  <div class="page-wrapper">
    {# --- Navbar Section (Keep using Webflow structure/classes) --- #}
    <div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="navbar w-nav">
      <div class="nav-container"> <a href="{{ url_for('main.index') }}" class="nav-brand-logo-wrapper w-nav-brand">
          <img src="{{ url_for('static', filename='images/Logo_New.png') }}" loading="lazy" alt="SlideaAI Logo" class="nav-brand-logo">
        </a>
        <nav role="navigation" class="nav-menu w-nav-menu">
          <a href="{{ url_for('main.index') }}" class="nav-link w-nav-link {% if request.endpoint == 'main.index' %}w--current{% endif %}">Home</a>
          <a href="{{ url_for('main.about') }}" class="nav-link w-nav-link {% if request.endpoint == 'main.about' %}w--current{% endif %}">About</a>
          <a href="{{ url_for('main.features') }}" class="nav-link w-nav-link {% if request.endpoint == 'main.features' %}w--current{% endif %}">Feature</a>
          <a href="{{ url_for('main.pricing') }}" class="nav-link w-nav-link {% if request.endpoint == 'main.pricing' %}w--current{% endif %}">Pricing</a>
          <a href="{{ url_for('main.contact') }}" class="nav-link w-nav-link {% if request.endpoint == 'main.contact' %}w--current{% endif %}">Contact</a>

          <div class="nav-button-wrapper hide-desktop">
            {% if current_user.is_authenticated %}
              <span class="nav-credits" title="Remaining Slide Credits">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-coin" viewBox="0 0 16 16"><path d="M5.5 9.511c.076.954.83 1.697 2.182 1.785V12h.6v-.709c1.4-.098 2.218-.846 2.218-1.932 0-.987-.626-1.496-1.745-1.76l-.473-.112V5.57c.6.068.982.396 1.074.85h1.052c-.076-.919-.864-1.638-2.126-1.716V4h-.6v.719c-1.195.117-2.01.836-2.01 1.853 0 .9.606 1.472 1.613 1.707l.397.098v2.034c-.615-.093-1.022-.43-1.114-.9H5.5zm2.177-2.166c-.59-.137-.91-.416-.91-.836 0-.47.345-.822.915-.925v1.76h-.005zm.692 1.193c.717.166 1.048.435 1.048.91 0 .542-.412.914-1.135.982V8.518z"/><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="M8 13.5a5.5 5.5 0 1 1 0-11 5.5 5.5 0 0 1 0 11m0 .5A6 6 0 1 0 8 2a6 6 0 0 0 0 12"/></svg>
                  {{ current_user.credits_remaining }}
              </span>
              <a data-wf--button--variant="base" href="{{ url_for('main.dashboard') }}" class="button-stroke w-inline-block"><div class="button"><div class="button-text">Dashboard</div></div></a>
              <a data-wf--button--variant="base" href="{{ url_for('main.account') }}" class="button-stroke w-inline-block"><div class="button" style="background-color: #333;"><div class="button-text">Account</div></div></a>
            {% else %}
              <a data-wf--button--variant="base" href="{{ url_for('main.register') }}" class="button-stroke w-inline-block"><div class="button"><div class="button-text">Get started</div></div></a>
               <a data-wf--button--variant="base" href="{{ url_for('main.login') }}" class="button-stroke w-inline-block"><div class="button" style="background-color: #333;"><div class="button-text">Login</div></div></a>
            {% endif %}
          </div>
        </nav>
        <div class="nav-button-wrapper hide-tablet">
           {% if current_user.is_authenticated %}
             <span class="nav-credits" title="Remaining Slide Credits">
                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-coin" viewBox="0 0 16 16"><path d="M5.5 9.511c.076.954.83 1.697 2.182 1.785V12h.6v-.709c1.4-.098 2.218-.846 2.218-1.932 0-.987-.626-1.496-1.745-1.76l-.473-.112V5.57c.6.068.982.396 1.074.85h1.052c-.076-.919-.864-1.638-2.126-1.716V4h-.6v.719c-1.195.117-2.01.836-2.01 1.853 0 .9.606 1.472 1.613 1.707l.397.098v2.034c-.615-.093-1.022-.43-1.114-.9H5.5zm2.177-2.166c-.59-.137-.91-.416-.91-.836 0-.47.345-.822.915-.925v1.76h-.005zm.692 1.193c.717.166 1.048.435 1.048.91 0 .542-.412.914-1.135.982V8.518z"/><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="M8 13.5a5.5 5.5 0 1 1 0-11 5.5 5.5 0 0 1 0 11m0 .5A6 6 0 1 0 8 2a6 6 0 0 0 0 12"/></svg>
                 {{ current_user.credits_remaining }}
             </span>
             <a data-wf--button--variant="base" href="{{ url_for('main.dashboard') }}" class="button-stroke w-inline-block"><div class="button"><div class="button-text">Dashboard</div></div></a>
             <a data-wf--button--variant="base" href="{{ url_for('main.account') }}" class="button-stroke w-inline-block"><div class="button" style="background-color: #333;"><div class="button-text">Account</div></div></a>
           {% else %}
             <a data-wf--button--variant="base" href="{{ url_for('main.register') }}" class="button-stroke w-inline-block"><div class="button"><div class="button-text">Get started</div></div></a>
              <a data-wf--button--variant="base" href="{{ url_for('main.login') }}" class="button-stroke w-inline-block" style="margin-left: 10px;"><div class="button" style="background-color: #333;"><div class="button-text">Login</div></div></a>
           {% endif %}
        </div>
        <div data-w-id="0023d2b2-573b-2e35-09d0-c21f6fb8add5" class="nav-menu-button w-nav-button">
          <div class="nav-menu-line-wrapper">
            <div class="nav-menu-line top"></div>
            <div class="nav-menu-line middle"></div>
            <div class="nav-menu-line last"></div>
          </div>
        </div>
      </div>
    </div>
    {# --- End Navbar Section --- #}

    <div class="main-wrapper">
      <div class="dashboard-section">
        <div class="padding-global">
          <div class="container-large">

            <div class="dashboard-header">
                <h1>Dashboard</h1>
                {# *** UPDATED BUTTON CLASS *** #}
                <a href="{{ url_for('main.create_presentation') }}" class="btn-create-glowy">
                     <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                     New Presentation
                </a>
            </div>

            <p class="dashboard-welcome">Welcome back, {{ current_user.name }}! Here are your presentations.</p>

            <div class="presentation-list-container">
                 {% with messages = get_flashed_messages(with_categories=true) %}
                   {% if messages %}
                     <div style="width: 100%; margin-bottom: 1rem;">
                       {% for category, message in messages %}
                         <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                             <span>{{ message }}</span>
                             <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                         </div>
                       {% endfor %}
                     </div>
                   {% endif %}
                 {% endwith %}

                 {% if presentation_results is defined and presentation_results %}
                    {% for pres, first_slide_image_url in presentation_results %}
                    <div class="presentation-card-wf"
                         id="presentation-{{ pres.id }}"
                         data-presentation-id="{{ pres.id }}"
                         data-initial-status="{{ pres.status.value }}">

                        <div class="thumbnail-container-wf">
                            {% if first_slide_image_url %}
                                <img src="{{ url_for('static', filename=first_slide_image_url) }}"
                                     alt="{{ pres.title }} thumbnail"
                                     onerror="this.onerror=null; this.parentElement.innerHTML='<span>Preview Error</span>';">
                            {% else %}
                                 <span>No Preview</span>
                            {% endif %}
                        </div>

                        <div class="presentation-content-wf">
                            <h5 class="presentation-title-wf mb-1">{{ pres.title }}</h5>
                            <p class="presentation-meta-wf">
                                Created: {{ pres.created_at.strftime('%b %d, %Y') }} |
                                Edited: {{ pres.last_edited_at.strftime('%b %d, %Y %H:%M') }}
                            </p>
                            <div class="presentation-status-wf">
                                 <span class="status-badge-wf" id="status-badge-wf-{{ pres.id }}">
                                     </span>
                            </div>
                        </div>

                        <div class="presentation-actions-wf" id="actions-wf-{{ pres.id }}">
                            <a href="{{ url_for('main.editor', presentation_id=pres.id) }}"
                               class="btn-action btn-action-edit" id="edit-button-wf-{{ pres.id }}">
                               <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                               Edit
                            </a>
                             <a href="{{ url_for('main.export_pptx', presentation_id=pres.id) }}"
                                class="btn-action-link"
                                id="export-button-wf-{{ pres.id }}"
                                target="_blank">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                                .pptx
                             </a>
                            <form method="POST" action="{{ url_for('main.cancel_presentation', presentation_id=pres.id) }}" onsubmit="return confirm('Cancel generating visuals?');" id="cancel-form-wf-{{ pres.id }}" hidden>
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                <button type="submit" class="btn-action-link cancel">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><rect width="6" height="6" x="9" y="9"/></svg>
                                    Cancel
                                </button>
                            </form>
                            <form method="POST" action="{{ url_for('main.delete_presentation', presentation_id=pres.id) }}" onsubmit="return confirm('Delete presentation permanently?');" id="delete-form-wf-{{ pres.id }}" hidden>
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                <button type="submit" class="btn-action-link delete">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                                    Delete
                                </button>
                            </form>
                        </div>
                    </div>
                    {% endfor %}
                 {% else %}
                    <div class="alert alert-info mt-4" role="alert" style="background-color: var(--theme-card-bg); border-color: var(--theme-card-border); color: var(--theme-text-secondary) !important;">
                        You haven't created any presentations yet. Click the "New Presentation" button to get started!
                    </div>
                 {% endif %}
            </div>

          </div>
        </div>
      </div>
    </div>

  {# JS Includes #}
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=67f1d16c9fcb04b14e6074f2" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="{{ url_for('static', filename='js/webflow.js') }}" type="text/javascript"></script>
  {# Include Bootstrap JS for alert dismissal #}
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

  {# JS for Fade-in Transition & Dashboard Polling & Staggered Animation #}
  <script>
    // Fade-in Logic
    document.addEventListener("DOMContentLoaded", function() {
      document.body.classList.add('loaded'); // Apply fade-in

      // Optional fade-out on link click
      const links = document.querySelectorAll('a:not([target="_blank"]):not([href^="#"])');
      links.forEach(link => {
        link.addEventListener('click', function(e) {
          const href = this.getAttribute('href');
          if (href && !href.startsWith('mailto:') && !href.startsWith('tel:') && !this.closest('form')) {
             e.preventDefault(); document.body.style.opacity = 0;
             setTimeout(() => { window.location.href = href; }, 500);
          }
        });
      });

       // JS to dismiss flash messages
       const alertContainer = document.querySelector('.presentation-list-container');
       if (alertContainer) {
           const alerts = alertContainer.querySelectorAll('.alert');
           alerts.forEach(function(alert) {
               setTimeout(() => {
                   if (typeof bootstrap !== 'undefined' && bootstrap.Alert) {
                       const bsAlert = bootstrap.Alert.getOrCreateInstance(alert);
                       if (bsAlert) { bsAlert.close(); }
                   } else {
                       alert.style.opacity = '0'; setTimeout(() => alert.remove(), 150);
                   }
               }, 5000);
           });
       }

        // Staggered Card Animation
        const presentationCards = document.querySelectorAll('.presentation-card-wf');
        presentationCards.forEach((card, index) => {
            card.style.animation = `fadeInUp 0.5s ease-out ${index * 0.08}s both`;
        });

        // Dashboard Polling Logic
        const presentationItems = document.querySelectorAll('[data-presentation-id]');
        const intervalIds = {};

        function updatePresentationUI(presentationId, status, completedSlides = null, totalSlides = null) {
            const statusBadge = document.getElementById(`status-badge-wf-${presentationId}`);
            const editButton = document.getElementById(`edit-button-wf-${presentationId}`);
            const exportButton = document.getElementById(`export-button-wf-${presentationId}`);
            const cancelForm = document.getElementById(`cancel-form-wf-${presentationId}`);
            const deleteForm = document.getElementById(`delete-form-wf-${presentationId}`);

            if (!statusBadge || !editButton || !exportButton || !cancelForm || !deleteForm) return;

            let badgeClass = 'bg-secondary'; let badgeContent = status;
            if (status === 'pending_visuals') {
                badgeClass = 'bg-pending';
                if (totalSlides !== null && completedSlides !== null && totalSlides > 0) {
                    badgeContent = completedSlides > 0 ? `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Generating (${completedSlides}/${totalSlides})...` : `Queued...`;
                } else { badgeContent = `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Generating...`; }
            } else if (status === 'generation_failed') {
                badgeClass = 'bg-failed';
                badgeContent = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg> Failed`;
            } else if (status === 'visuals_complete') {
                badgeClass = 'bg-complete';
                badgeContent = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg> Ready`;
            } else { badgeClass = 'bg-secondary'; badgeContent = status; }

            statusBadge.className = `status-badge-wf ${badgeClass}`;
            statusBadge.innerHTML = badgeContent;
            const isPending = (status === 'pending_visuals');
            const isComplete = (status === 'visuals_complete');
            editButton.classList.toggle('disabled', isPending);
            editButton.style.pointerEvents = isPending ? 'none' : 'auto';
            editButton.hidden = false;
            exportButton.classList.toggle('disabled', !isComplete);
            exportButton.style.pointerEvents = isComplete ? 'auto' : 'none';
            exportButton.hidden = false;
            cancelForm.hidden = !isPending;
            deleteForm.hidden = isPending;
            editButton.setAttribute('title', isPending ? 'Cannot edit while generating' : 'Edit Presentation');
            exportButton.setAttribute('title', !isComplete ? 'Cannot export until complete' : 'Export as PPTX');
        }

        async function checkStatus(presentationId, isInitialLoad = false) {
            try {
                const response = await fetch(`/api/presentation/${presentationId}/status`);
                if (!response.ok) {
                    console.error(`Error fetching status for ${presentationId}: ${response.statusText}`);
                    if (intervalIds[presentationId]) { clearInterval(intervalIds[presentationId]); delete intervalIds[presentationId]; }
                    return;
                }
                const data = await response.json();
                const newStatus = data.status;
                const completedSlides = data.completed_slides;
                const totalSlides = data.total_slides;
                const currentStatusElement = document.getElementById(`presentation-${presentationId}`);
                const currentStatus = currentStatusElement ? currentStatusElement.dataset.initialStatus : 'pending_visuals';

                if (isInitialLoad || newStatus !== currentStatus) {
                    console.log(`Status update for ${presentationId}: ${newStatus} (Completed: ${completedSlides}/${totalSlides})`);
                    updatePresentationUI(presentationId, newStatus, completedSlides, totalSlides);
                    if(currentStatusElement) currentStatusElement.dataset.initialStatus = newStatus;
                } else if (newStatus === 'pending_visuals') {
                     updatePresentationUI(presentationId, newStatus, completedSlides, totalSlides);
                }

                if (newStatus !== 'pending_visuals' && intervalIds[presentationId]) {
                    clearInterval(intervalIds[presentationId]);
                    delete intervalIds[presentationId];
                    console.log(`Stopped polling for ${presentationId} (Status: ${newStatus})`);
                }
            } catch (error) {
                console.error(`Network error checking status for ${presentationId}:`, error);
                 if (intervalIds[presentationId]) { clearInterval(intervalIds[presentationId]); delete intervalIds[presentationId]; }
            }
        }

        presentationItems.forEach(item => {
            const presentationId = item.dataset.presentationId;
            const initialStatus = item.dataset.initialStatus;
            checkStatus(presentationId, true);
            if (initialStatus === 'pending_visuals') {
                console.log(`Starting polling for ${presentationId}`);
                intervalIds[presentationId] = setInterval(() => checkStatus(presentationId), 7000);
            }
        });

    }); // End DOMContentLoaded

  </script>
</body>
</html>
