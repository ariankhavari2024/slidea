<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta content="Webflow" name="generator">
    {# CSRF Token Meta Tag #}
    <meta name="csrf-token" content="{{ csrf_token() }}">

    <title>Account Overview - SlideaAI</title>

    {# Link CSS using url_for #}
    <link href="{{ url_for('static', filename='css/normalize.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/webflow.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ url_for('static', filename='css/slidea-ai-ui.webflow.css') }}" rel="stylesheet" type="text/css">
    {# Include Bootstrap CSS for Alert Dismissal #}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    {# Fonts #}
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
    <script type="text/javascript">WebFont.load({  google: {    families: ["Be Vietnam Pro:regular,500,600"]  }});</script>
    <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>

    {# Favicons #}
    <link href="{{ url_for('static', filename='images/custom_favicon.png') }}" rel="shortcut icon" type="image/x-icon">
    <link href="{{ url_for('static', filename='images/custom_favicon.png') }}" rel="apple-touch-icon">

    {# Styles for Navbar, Credits, and Account Page Content #}
    <style>
      :root {
        /* Define theme colors if not globally available */
        --theme-bg: #090911; /* Example from index */
        --theme-card-bg: #1E293B; /* Dark slate */
        --theme-card-border: rgba(71, 85, 105, 0.4); /* Slate border */
        --theme-text-primary: #F1F5F9; /* Off-white */
        --theme-text-secondary: #94A3B8; /* Lighter grey */
        --theme-accent: #8B5CF6; /* Vibrant Purple */
        --theme-button-action: #5865F2; /* Discord-like blue */
        --theme-button-action-hover: #4752C4;
        --theme-button-secondary: #475569; /* Slate for secondary actions */
        --theme-button-secondary-hover: #525f76;
        --theme-button-danger: #ED4245; /* Discord red for logout */
        --theme-button-danger-hover: #c63537;
        --credit-color: #facc15; /* Yellow-500 */
        --credit-glow-color: rgba(250, 204, 21, 0.5); /* Yellow-400 with opacity */
        --border-radius-base: 0.75rem; /* 12px */
        --border-radius-small: 0.375rem; /* 6px */
      }
      body {
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
        background-color: var(--theme-bg); /* Use a base background */
        color: var(--theme-text-secondary); /* Default text color */
        font-family: "Be Vietnam Pro", sans-serif; /* Default font */
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }
      body.loaded {
          opacity: 1;
      }
      main.flex-grow-1 {
          flex-grow: 1;
      }
      /* Navbar Styles */
      .navbar.w-nav { background-color: transparent !important; box-shadow: none !important; border-bottom: 1.25px solid rgba(255, 255, 255, 0.1); padding-top: 1rem; padding-bottom: 1rem; }
      .navbar .button-stroke { background-image: none; border: 1px solid var(--theme-text-secondary); padding: 1px; transition: all 0.2s ease; border-radius: 0.375rem; }
      .navbar .button-stroke .button { background-color: transparent; padding: 0.5rem 1rem !important; font-size: 0.9rem !important; color: var(--theme-text-secondary); transition: all 0.2s ease; border-radius: 0.375rem; }
      .navbar .button-stroke:hover { border-color: var(--theme-text-primary); }
      .navbar .button-stroke:hover .button { background-color: rgba(255, 255, 255, 0.1); color: var(--theme-text-primary); }
      .navbar .button-stroke .button img { display: none; } /* Hide original button bg image */
      .navbar .nav-link {
          color: var(--theme-text-secondary) !important;
          transition: color 0.2s ease;
          padding: 0.5rem 0.8rem; /* Reduced padding */
          font-weight: 500;
          line-height: 1rem;
          font-size: 0.8rem; /* Reduced font size */
      }
      .navbar .nav-link:hover, .navbar .nav-link.w--current { color: var(--theme-text-primary) !important; }
      .nav-brand-logo { max-height: 35px; margin-right: 1rem;} /* Adjust logo size */
      .nav-container { max-width: 1140px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; width: 100%; padding-left: 1.5rem; padding-right: 1.5rem; } /* Standard padding */
      .nav-menu { display: flex; align-items: center; gap: 1rem; } /* Reduced gap slightly */
      .nav-button-wrapper.hide-tablet { display: flex; align-items: center; gap: 0.75rem; margin-left: auto; }
      .nav-menu-button { display: none; cursor: pointer; padding: 12px; }
      .nav-menu-line { width: 24px; height: 2px; background-color: #fff; margin: 4px 0; display: block; transition: transform 0.3s ease; }
      .nav-menu-button.w--open .nav-menu-line.top { transform: translateY(6px) rotate(45deg); }
      .nav-menu-button.w--open .nav-menu-line.middle { opacity: 0; }
      .nav-menu-button.w--open .nav-menu-line.last { transform: translateY(-6px) rotate(-45deg); }

       /* Credit Display Style */
       .nav-credits {
           color: var(--credit-color) !important;
           margin-left: 0.5rem;
           margin-right: 0.5rem;
           font-size: 0.8em; /* Slightly smaller to match nav links */
           font-weight: 600;
           display: inline-flex;
           align-items: center;
           padding: 0.3rem 0.6rem; /* Adjusted padding */
           line-height: 1;
           text-shadow: 0 0 6px var(--credit-glow-color); /* Reduced glow */
           white-space: nowrap;
       }
       .nav-credits svg {
           width: 0.9em; height: 0.9em; /* Slightly smaller icon */
           margin-right: 0.3em;
           fill: currentColor; vertical-align: -0.1em;
           filter: drop-shadow(0 0 2px var(--credit-glow-color));
       }

      /* Alert styling */
      .alert { padding: 0.75rem 1.25rem; margin-bottom: 1rem; border: 1px solid transparent; border-radius: .375rem; width: 100%; box-sizing: border-box; font-size: 0.9rem; display: flex; justify-content: space-between; align-items: center; position: relative; z-index: 1056; }
      .alert-danger { color: #842029 !important; background-color: #f8d7da !important; border-color: #f5c2c7 !important; }
      .alert-success { color: #0f5132 !important; background-color: #d1e7dd !important; border-color: #badbcc !important; }
      .alert-warning { color: #664d03 !important; background-color: #fff3cd !important; border-color: #ffecb5 !important; }
      .alert-info { color: #055160 !important; background-color: #cff4fc !important; border-color: #b6effb !important; }
      .alert .btn-close { padding: 0.5rem 0.75rem; background: transparent; border: 0; opacity: 0.7; filter: invert(1) grayscale(100%) brightness(200%); }
      #flash-message-container { position: fixed; top: 5rem; left: 50%; transform: translateX(-50%); z-index: 1060; width: 90%; max-width: 600px;}

      /* Mobile Menu Styles */
      @media screen and (max-width: 991px) {
        .nav-menu { display: none; position: absolute; top: 100%; left: 0; right: 0; background: #13131b; padding: 1rem; flex-direction: column; gap: 0.5rem; border-bottom-left-radius: .75rem; border-bottom-right-radius: .75rem; box-shadow: 0 8px 15px rgba(0,0,0,0.2);}
        .nav-menu.w--open { display: flex; }
        .nav-button-wrapper.hide-tablet { display: none; margin-left: 0; }
        .nav-button-wrapper.hide-desktop { display: flex; flex-direction: column; gap: 0.5rem; width: 100%; padding-top: 1rem; border-top: 1px solid rgba(255, 255, 255, 0.1); }
        .nav-button-wrapper.hide-desktop .button-stroke { width: 100%; text-align: center; margin-left: 0 !important;}
        .nav-menu-button { display: block; }
        .nav-container { padding-left: 1rem; padding-right: 1rem; } /* Reduce padding on smaller screens */
        .navbar .nav-link { padding: 0.6rem 1rem; /* Adjust padding for mobile dropdown */ font-size: 0.9rem; /* Slightly larger on mobile dropdown */ }
      }

      /* Account Page Specific Styles */
      .account-section { padding-top: 4rem; padding-bottom: 6rem; flex-grow: 1; }
      .account-header h1 { font-size: 2.5rem; line-height: 1.2; font-weight: 600; margin-bottom: 0.5rem; color: var(--theme-text-primary) !important; }
      .account-header p { font-size: 1.1rem; color: var(--theme-text-secondary) !important; margin-bottom: 3rem; }
      .account-card { background-color: var(--theme-card-bg); border: 1px solid var(--theme-card-border); border-radius: var(--border-radius-base); padding: 2rem 2.5rem; margin-bottom: 2rem; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2); }
      .account-card-header { font-size: 1.35rem; font-weight: 600; color: var(--theme-text-primary) !important; margin-bottom: 1.75rem; padding-bottom: 1rem; border-bottom: 1px solid var(--theme-card-border); }
      .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; }
      .info-item dt { font-size: 0.9rem; font-weight: 500; color: var(--theme-text-secondary) !important; margin-bottom: 0.4rem; text-transform: uppercase; letter-spacing: 0.05em; }
      .info-item dd { font-size: 1.05rem; font-weight: 500; color: var(--theme-text-primary) !important; margin-left: 0; word-wrap: break-word; }
      .info-item dd .badge { font-size: 0.8em; padding: 0.35em 0.7em; vertical-align: middle; margin-left: 0.5em; }
      .credits-display { font-size: 2rem; font-weight: 600; color: var(--credit-color) !important; text-shadow: 0 0 10px var(--credit-glow-color); display: inline-flex; align-items: center; gap: 0.6rem; }
      .credits-display svg { width: 1.3em; height: 1.3em; fill: currentColor; filter: drop-shadow(0 0 4px var(--credit-glow-color)); }
      .btn-account-action { color: white !important; padding: 0.7rem 1.4rem; border-radius: var(--border-radius-small); text-decoration: none; display: inline-flex; align-items: center; justify-content: center; font-weight: 500; border: none; transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease; font-size: 0.95rem; box-shadow: 0 2px 5px rgba(0,0,0,0.15); }
      .btn-account-action:hover { transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
      .btn-account-action svg { margin-right: 0.6em; width: 1.2em; height: 1.2em; }
      .btn-manage-billing { background-color: var(--theme-button-action) !important; }
      .btn-manage-billing:hover { background-color: var(--theme-button-action-hover) !important; }
      .btn-recharge-credits { background-color: var(--theme-button-secondary) !important; }
      .btn-recharge-credits:hover { background-color: var(--theme-button-secondary-hover) !important; }
      .btn-logout { background-color: var(--theme-button-danger) !important; margin-top: 1.5rem; }
      .btn-logout:hover { background-color: var(--theme-button-danger-hover) !important; }
      .disabled-link { opacity: 0.6; cursor: not-allowed; pointer-events: none; box-shadow: none !important; transform: none !important; }
      .button-group-account { display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 1rem; }
      .form-text-small { font-size: 0.8rem; color: var(--theme-text-secondary); opacity: 0.8; margin-top: 0.5rem; display: block; }
    </style>

</head>
<body class="body-fade-in">
  <div class="page-wrapper">

    {# Navbar Section - Copied from base.html for context #}
    <div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="navbar w-nav">
        <div class="nav-container">
          <a href="{{ url_for('main.index') }}" class="nav-brand-logo-wrapper w-nav-brand">
              <img src="{{ url_for('static', filename='images/Logo_New.png') }}" loading="lazy" alt="Nav Logo" class="nav-brand-logo">
          </a>
          <nav role="navigation" class="nav-menu w-nav-menu">
            <a href="{{ url_for('main.index') }}" class="nav-link w-nav-link">Home</a>
            <a href="{{ url_for('main.about') }}" class="nav-link w-nav-link">About</a>
            <a href="{{ url_for('main.features') }}" class="nav-link w-nav-link">Feature</a>
            <a href="{{ url_for('main.pricing') }}" class="nav-link w-nav-link">Pricing</a>
            <a href="{{ url_for('main.contact') }}" class="nav-link w-nav-link">Contact</a>

            <div class="nav-button-wrapper hide-desktop">
              {% if current_user.is_authenticated %}
                <span class="nav-credits" title="Remaining Slide Credits">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-coin" viewBox="0 0 16 16"><path d="M5.5 9.511c.076.954.83 1.697 2.182 1.785V12h.6v-.709c1.4-.098 2.218-.846 2.218-1.932 0-.987-.626-1.496-1.745-1.76l-.473-.112V5.57c.6.068.982.396 1.074.85h1.052c-.076-.919-.864-1.638-2.126-1.716V4h-.6v.719c-1.195.117-2.01.836-2.01 1.853 0 .9.606 1.472 1.613 1.707l.397.098v2.034c-.615-.093-1.022-.43-1.114-.9H5.5zm2.177-2.166c-.59-.137-.91-.416-.91-.836 0-.47.345-.822.915-.925v1.76h-.005zm.692 1.193c.717.166 1.048.435 1.048.91 0 .542-.412.914-1.135.982V8.518z"/><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="M8 13.5a5.5 5.5 0 1 1 0-11 5.5 5.5 0 0 1 0 11m0 .5A6 6 0 1 0 8 2a6 6 0 0 0 0 12"/></svg>
                    {{ current_user.credits_remaining }}
                </span>
                <a data-wf--button--variant="base" href="{{ url_for('main.dashboard') }}" class="button-stroke w-inline-block"><div class="button"><div class="button-text">Dashboard</div></div></a>
                <a data-wf--button--variant="base" href="{{ url_for('main.logout') }}" class="button-stroke w-inline-block" style="margin-left: 10px;"><div class="button" style="background-color: var(--theme-button-danger); color: white;"><div class="button-text">Logout</div></div></a>
              {% else %}
                <a data-wf--button--variant="base" href="{{ url_for('main.register') }}" class="button-stroke w-inline-block"><div class="button"><div class="button-text">Get started</div></div></a>
                 <a data-wf--button--variant="base" href="{{ url_for('main.login') }}" class="button-stroke w-inline-block" style="margin-left: 10px;"><div class="button" style="background-color: #333;"><div class="button-text">Login</div></div></a>
              {% endif %}
            </div>
          </nav>
          <div class="nav-button-wrapper hide-tablet">
             {% if current_user.is_authenticated %}
               <span class="nav-credits" title="Remaining Slide Credits">
                   <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-coin" viewBox="0 0 16 16"><path d="M5.5 9.511c.076.954.83 1.697 2.182 1.785V12h.6v-.709c1.4-.098 2.218-.846 2.218-1.932 0-.987-.626-1.496-1.745-1.76l-.473-.112V5.57c.6.068.982.396 1.074.85h1.052c-.076-.919-.864-1.638-2.126-1.716V4h-.6v.719c-1.195.117-2.01.836-2.01 1.853 0 .9.606 1.472 1.613 1.707l.397.098v2.034c-.615-.093-1.022-.43-1.114-.9H5.5zm2.177-2.166c-.59-.137-.91-.416-.91-.836 0-.47.345-.822.915-.925v1.76h-.005zm.692 1.193c.717.166 1.048.435 1.048.91 0 .542-.412.914-1.135.982V8.518z"/><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="M8 13.5a5.5 5.5 0 1 1 0-11 5.5 5.5 0 0 1 0 11m0 .5A6 6 0 1 0 8 2a6 6 0 0 0 0 12"/></svg>
                   {{ current_user.credits_remaining }}
               </span>
               <a data-wf--button--variant="base" href="{{ url_for('main.dashboard') }}" class="button-stroke w-inline-block"><div class="button"><div class="button-text">Dashboard</div></div></a>
               <a data-wf--button--variant="base" href="{{ url_for('main.logout') }}" class="button-stroke w-inline-block" style="border-color: var(--theme-button-danger);"><div class="button" style="background-color: var(--theme-button-danger); color: white;"><div class="button-text">Logout</div></div></a>
             {% else %}
               <a data-wf--button--variant="base" href="{{ url_for('main.register') }}" class="button-stroke w-inline-block"><div class="button"><div class="button-text">Get started</div></div></a>
                <a data-wf--button--variant="base" href="{{ url_for('main.login') }}" class="button-stroke w-inline-block" style="margin-left: 10px;"><div class="button" style="background-color: #333;"><div class="button-text">Login</div></div></a>
             {% endif %}
          </div>
          <div data-w-id="0023d2b2-573b-2e35-09d0-c21f6fb8add5" class="nav-menu-button w-nav-button">
            <div class="nav-menu-line-wrapper"><div class="nav-menu-line top"></div><div class="nav-menu-line middle"></div><div class="nav-menu-line last"></div></div>
          </div>
        </div>
      </div>
    {# End Navbar #}

    {# Container for Flash Messages #}
    <div id="flash-message-container" class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        <span>{{ message }}</span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    {# Main Account Content #}
    <main class="flex-grow-1">
        <div class="account-section">
            <div class="padding-global">
                <div class="container-large">
                    <div class="account-header">
                        <h1>Account Overview</h1>
                        <p>Manage your profile, subscription, and credits.</p>
                    </div>
                    <div class="account-card">
                        <div class="account-card-header">Profile Information</div>
                        <dl class="info-grid">
                            <div class="info-item"> <dt>Name</dt> <dd>{{ current_user.name }}</dd> </div>
                            <div class="info-item"> <dt>Email</dt> <dd>{{ current_user.email }}</dd> </div>
                            <div class="info-item"> <dt>Account Created</dt> <dd>{{ current_user.created_at.strftime('%B %d, %Y') }}</dd> </div>
                        </dl>
                        <a href="{{ url_for('main.logout') }}" class="btn-account-action btn-logout">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 4.25A2.25 2.25 0 015.25 2h5.5A2.25 2.25 0 0113 4.25v2a.75.75 0 01-1.5 0v-2a.75.75 0 00-.75-.75h-5.5a.75.75 0 00-.75.75v11.5c0 .414.336.75.75.75h5.5a.75.75 0 00.75-.75v-2a.75.75 0 011.5 0v2A2.25 2.25 0 0110.75 18h-5.5A2.25 2.25 0 013 15.75V4.25z" clip-rule="evenodd" /><path fill-rule="evenodd" d="M19 10a.75.75 0 00-.75-.75h-5.5a.75.75 0 000 1.5h5.5a.75.75 0 00.75-.75z" clip-rule="evenodd" /><path fill-rule="evenodd" d="M16.72 12.72a.75.75 0 011.06 0l2.25 2.25a.75.75 0 010 1.06l-2.25 2.25a.75.75 0 11-1.06-1.06L17.69 15l-1.03-1.03a.75.75 0 010-1.06z" clip-rule="evenodd" /></svg>
                            Logout
                        </a>
                    </div>
                    <div class="account-card">
                        <div class="account-card-header">Credits & Subscription</div>
                        <div class="info-grid">
                            <div class="info-item">
                                <dt>Available Credits</dt>
                                <dd> <span class="credits-display"> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-coin" viewBox="0 0 16 16"><path d="M5.5 9.511c.076.954.83 1.697 2.182 1.785V12h.6v-.709c1.4-.098 2.218-.846 2.218-1.932 0-.987-.626-1.496-1.745-1.76l-.473-.112V5.57c.6.068.982.396 1.074.85h1.052c-.076-.919-.864-1.638-2.126-1.716V4h-.6v.719c-1.195.117-2.01.836-2.01 1.853 0 .9.606 1.472 1.613 1.707l.397.098v2.034c-.615-.093-1.022-.43-1.114-.9H5.5zm2.177-2.166c-.59-.137-.91-.416-.91-.836 0-.47.345-.822.915-.925v1.76h-.005zm.692 1.193c.717.166 1.048.435 1.048.91 0 .542-.412.914-1.135.982V8.518z"/><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="M8 13.5a5.5 5.5 0 1 1 0-11 5.5 5.5 0 0 1 0 11m0 .5A6 6 0 1 0 8 2a6 6 0 0 0 0 12"/></svg> {{ current_user.credits_remaining }} </span> </dd>
                                <div class="button-group-account"> <a href="{{ url_for('main.pricing') }}" class="btn-account-action btn-recharge-credits"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" /></svg> Add Credits / Upgrade </a> </div>
                                <span class="form-text-small">Credits are used for generating slides.</span>
                            </div>
                            <div class="info-item">
                                <dt>Subscription Plan</dt>
                                <dd> {{ current_user.subscription_plan_name | capitalize if current_user.subscription_plan_name else 'Free' }} {% if current_user.is_subscribed %} <span class="badge rounded-pill text-bg-success">{{ current_user.subscription_status | capitalize }}</span> {% elif current_user.subscription_status and current_user.subscription_status != 'active' and current_user.subscription_status != 'trialing' %} <span class="badge rounded-pill text-bg-warning">{{ current_user.subscription_status | capitalize }}</span> {% else %} <span class="badge rounded-pill text-bg-secondary">Free Tier</span> {% endif %} </dd>
                            </div>
                            {% if current_user.is_subscribed and current_user.subscription_current_period_end %}
                            <div class="info-item"> <dt>Current Period Ends</dt> <dd>{{ current_user.subscription_current_period_end.strftime('%B %d, %Y') }}</dd> </div>
                            {% endif %}
                            <div class="info-item" style="grid-column: span 1 / span 1; align-self: end;">
                                {# This form POSTs to the /create-portal-session route #}
                                <form action="{{ url_for('main.create_portal_session') }}" method="POST" style="margin-bottom: 0;">
                                     <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                     {# Button is disabled if user has no stripe_customer_id #}
                                     <button type="submit" class="btn-account-action btn-manage-billing {% if not current_user.stripe_customer_id %}disabled-link{% endif %}" {% if not current_user.stripe_customer_id %}disabled title="No billing information found"{% endif %}>
                                         <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"> <path d="M4.5 3a2.5 2.5 0 015 0v9a1.5 1.5 0 01-3 0V5a.5.5 0 011 0v7a.5.5 0 001 0V3a1.5 1.5 0 10-3 0v9a2.5 2.5 0 005 0V5a.5.5 0 011 0v7a3.5 3.5 0 11-7 0V3z" /> </svg> Manage Billing & Subscription
                                     </button>
                                </form>
                                 <span class="form-text-small">Manage payment methods and subscription via Stripe.</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

  </div>{# End page-wrapper #}

  {# JS Includes #}
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=67f1d16c9fcb04b14e6074f2" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="{{ url_for('static', filename='js/webflow.js') }}" type="text/javascript"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

  {# Base JS (Fade-in, Alert Dismissal, Navbar Toggle) #}
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      document.body.classList.add('loaded'); // Apply fade-in effect

      // Fade-out on internal link clicks
      const links = document.querySelectorAll('a:not([target="_blank"]):not([href^="#"]):not(.w-tab-link):not(.w-dropdown-toggle)');
      links.forEach(link => {
        link.addEventListener('click', function(e) {
          const href = this.getAttribute('href');
          // Prevent immediate navigation only if it's a valid internal link
          // AND it's not part of the form that POSTs to create_portal_session
          if (href && !href.startsWith('mailto:') && !href.startsWith('tel:') && !this.closest('form[action*="create_portal_session"]')) {
             e.preventDefault(); // Prevent default link behavior
             document.body.style.opacity = 0; // Start fade-out
             // Wait for fade out before navigating
             setTimeout(() => { window.location.href = href; }, 500); // Match CSS transition duration
          }
        });
      });

       // JS to dismiss flash messages (uses Bootstrap JS now)
       const alertContainer = document.getElementById('flash-message-container');
       if (alertContainer) {
           const alerts = alertContainer.querySelectorAll('.alert');
           alerts.forEach(function(alert) {
               // Auto-dismiss after 5 seconds
               setTimeout(() => {
                   if (typeof bootstrap !== 'undefined' && bootstrap.Alert) {
                       const bsAlert = bootstrap.Alert.getOrCreateInstance(alert);
                       if (bsAlert) { bsAlert.close(); }
                   } else { // Fallback if Bootstrap JS isn't loaded
                       alert.style.opacity = '0';
                       setTimeout(() => alert.remove(), 150); // Match fade duration
                   }
               }, 5000); // 5 seconds
           });
       }

       // Navbar toggle logic (Basic example, adapt if using Webflow's JS)
       const menuButton = document.querySelector('.nav-menu-button');
       const navMenu = document.querySelector('.nav-menu.w-nav-menu'); // Target the Webflow menu class
       if (menuButton && navMenu) {
           menuButton.addEventListener('click', function() {
               // Toggle classes for Webflow compatibility (or your custom JS logic)
               menuButton.classList.toggle('w--open'); // Webflow's class for open button state
               navMenu.classList.toggle('w--open'); // Webflow's class for open menu state
           });
       }
    });
  </script>

</body>
</html>
